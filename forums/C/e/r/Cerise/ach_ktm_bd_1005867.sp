/* Plugin Template generated by Pawn Studio */

#include <sourcemod>
#include <sdktools>
#include <sdktools_stocks>
#include <tf2>
#include <tf2_stocks>

#define ACHIEVEMENT_SOUND 		"misc/achievement_earned.wav"
#define ACHIEVEMENT_PARTICLE 	"Achieved"
#define SCORED_SOUND			"player/taunt_bell.wav"

#define CUSTOMACHVERSION		"0.6"

#define CVAR_ACHIEVEMENTS		0
#define CVAR_VERSION			1
#define VAL_NUM_CVARS			2
#define DF_CRITS				1048576	//crits = DAMAGE_ACID
#define DMG_VEHICLE				16
#define DMG_NERVEGAS			65536
#define DMG_FALL				32

/*---------------------------------------------------------------------------------
                      C U S T O M   A C H I E V E M E N T S  V 0 . 6 
---------------------------------------------------------------------------------*/
//Variables needed to make the plugin running !
//Data from CustomAchivement.sp
new Handle:cvURL = INVALID_HANDLE;
new Handle:cvDB = INVALID_HANDLE;
new Handle:cvTablePrefix = INVALID_HANDLE;
new Handle:hDatabaseConnection = INVALID_HANDLE;
new bool:bConnected = false;
new String:sTablePrefix[64];
new iPassInt[256][4];
new iCurPass = 0;
new Handle:g_cvars[VAL_NUM_CVARS];
new g_ClientConfigForPlugins[MAXPLAYERS+1] = {0, ...};
new String:g_ClientSteamID[MAXPLAYERS+1][255];
new String:g_ClientDeleteAchievement[MAXPLAYERS+1][500];

/*---------------------------------------------------------------------------------
                  A C H I E V E M E N T  K I L L  B Y  M Y S Q L
---------------------------------------------------------------------------------*/
//Data for : ach_server : 19 multiple fields
//These packs could be compared to a pile or an arrayList in Java : 
//They only store data, w/o requesting types !

new Handle:g_bd_id;
new Handle:g_bd_ida;
new Handle:g_bd_victim_bool;
new Handle:g_bd_attacker_bool;
new Handle:g_bd_assister_bool;
new Handle:g_bd_victim_steamid;
new Handle:g_bd_attacker_steamid;
new Handle:g_bd_assister_steamid;
new Handle:g_bd_weapon;
new Handle:g_bd_map;
new Handle:g_bd_victim_name;
new Handle:g_bd_attacker_name;
new Handle:g_bd_assister_name;
new Handle:g_bd_domination;
new Handle:g_bd_revenge;
new Handle:g_bd_headshot;
new Handle:g_bd_backstab;
new Handle:g_bd_deadringer;
new Handle:g_bd_class;
new Handle:g_bd_class_2;
new Handle:g_bd_crits;
new Handle:g_bd_distancemoinsplusegal;
new Handle:g_bd_distance1;
new Handle:g_bd_distance2;
new Handle:g_bd_hpmoinsplusegal;
new Handle:g_bd_hptext;
new Handle:g_bd_hptext2;
new Handle:g_bd_nbrKilled;
new Handle:g_bd_suicide;
new Handle:g_panel_menu;
new g_maxAchievements;

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
				          A C H I E V E M E N T  M E D I C
---------------------------------------------------------------------------------*/

new Handle:g_bd_id_medic; // table id
new Handle:g_bd_ida_medic; // server table id
new Handle:g_bd_ubercharge_weapons;
new g_maxAchievements_medic;

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
				          A C H I E V E M E N T  S C O U T
---------------------------------------------------------------------------------*/
new Handle:g_bd_id_scout; // table id
new Handle:g_bd_ida_scout; // server table id
new Handle:g_bd_stunt_scout;
new Handle:g_bd_bonk_scout;
new Handle:g_bd_stuntvic_scout;
new Handle:g_bd_stuntattack_scout;
new g_maxAchievements_scout;

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
				         A C H I E V E M E N T  S N I P E R
---------------------------------------------------------------------------------*/
new Handle:g_bd_id_sniper; // table id
new Handle:g_bd_ida_sniper; // server table id
new Handle:g_bd_ida_sniper_jarate; 
new Handle:g_bd_ida_sniper_jarate_vic;
new Handle:g_bd_ida_sniper_jarate_attack;
new Handle:g_bd_ida_sniper_razor; 
new Handle:g_bd_ida_sniper_razor_vic; 
new Handle:g_bd_ida_sniper_razor_attack; 
new g_maxAchievements_sniper;

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
				       A C H I E V E M E N T  E N G I N E E R
---------------------------------------------------------------------------------*/
new Handle:g_bd_id_engineer; // table id
new Handle:g_bd_ida_engineer; // server table id
new Handle:g_bd_engineer_construction;
new Handle:g_bd_engineer_destruction;
new Handle:g_bd_engineer_sentry;
new Handle:g_bd_engineer_dispenser;
new Handle:g_bd_engineer_teleporterentry;
new Handle:g_bd_engineer_teleporterexit;
new Handle:g_bd_engineer_teleport;
new Handle:g_bd_engineer_teleport_build;
new Handle:g_bd_engineer_teleport_play;
new Handle:g_bd_engineer_des_vic;
new Handle:g_bd_engineer_des_attack;
new Handle:g_bd_engineer_des_was_build;
new g_maxAchievements_engineer;


/*---------------------------------------------------------------------------------
                                      V 0 . 6 
				          A C H I E V E M E N T  H E A V Y
---------------------------------------------------------------------------------*/
new Handle:g_bd_id_heavy; // table id
new Handle:g_bd_ida_heavy; // server table id
new Handle:g_bd_ida_heavy_own;
new Handle:g_bd_ida_heavy_notown;
new Handle:g_bd_ida_heavy_notown_target;
new Handle:g_bd_ida_heavy_notown_own;
new g_maxAchievements_heavy;

/*---------------------------------------------------------------------------------
                                    V 0 . 6 
				          A C H I E V E M E N T  F U N 
---------------------------------------------------------------------------------*/
new Handle:g_bd_id_fun; // table id
new Handle:g_bd_ida_fun; // server table id
new Handle:g_bd_say_fun;
new Handle:g_bd_callmedic_fun;
new g_maxAchievements_fun;

//Server Data.
//Needed data when calling the event "Player Death"
new g_victim;
new g_attacker;
new String:g_weapon[128];
new g_customkill;
new g_target;
new g_domination;
new g_revenge;
new g_assister;
new g_deadringer;
new g_damagebits;
new g_nbrKilled;
new String:g_map[64];

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
				               I N F O  P L U G I N
---------------------------------------------------------------------------------*/
//Generated code by Pawn Studio !
//Plugin v1.0 compatible sourcemod 1.4
public Plugin:myinfo = 
{
	name = "Custom Achievement Kill Manager With MYSQL",
	author = "Pfsm999, GachL, linux_lover & Jindo",
	description = "Manage achievements based on weapons + classes based kills/deaths with creation by database.",
	version = CUSTOMACHVERSION,
	url = "http://www.chicken-team.com"
}

/*---------------------------------------------------------------------------------
				    W H E N  T H E  P L U G I N  I S  C H A R G E D
---------------------------------------------------------------------------------*/
//Loaded methods automatically called by Sourcemod !
public OnPluginStart()
{
	LoadTranslations("customach.phrases");
	g_cvars[CVAR_VERSION] = CreateConVar("sm_customach_version", CUSTOMACHVERSION, "Current version of the Kill-based Achievement Manager.");
	g_cvars[CVAR_ACHIEVEMENTS] = CreateConVar("sm_customach_num", "0", "Number of achievements according to the config.");
	
	cvURL = CreateConVar("sm_customach_url", "http://ns304110.ovh.net/achievements/player.php", "Url to the php file that shows player achievements.");
	cvDB = CreateConVar("sm_customach_db", "default", "DB to use");
	cvTablePrefix = CreateConVar("sm_customach_prefix", "ach_", "Table prefix");
	
	//To 0.1
	HookEvent("player_death", eCheckFile);
	//Add 0.6
	HookEvent("player_chargedeployed", eCheckUber);
	HookEvent("player_builtobject", eCheckEngi);
	HookEvent("object_destroyed", eCheckEngi2);
	HookEvent("player_teleported", eCheckEngi3);
	HookEvent("player_stunned", eCheckStun);
	HookEvent("player_stealsandvich", eStealSandvich);
	HookEvent("player_calledformedic", eMedicCall);
	HookUserMessage(GetUserMessageId("PlayerJarated"), eJarated);
	HookUserMessage(GetUserMessageId("PlayerShieldBlocked"), eShieldBlocked);
	AddNormalSoundHook(NormalSHook:HookSound_Callback);
	
	//Checking everything typed by the client only
	RegConsoleCmd("say", Command_Say);
	RegConsoleCmd("say_team", Command_Say);
	//Creating triggers for people using console ! 
	RegConsoleCmd("achievements_site", cShowAchievements);
	RegConsoleCmd("show_achievements", cShowAchievements);
	RegConsoleCmd("achievements", Panel_Menu);
	//Gives admin the possibility to refresh the plugin !
	RegAdminCmd("sm_customach_refresh", cConfig, ADMFLAG_SLAY);
	//Precaching sounds needed for success !
	PrecacheSound(ACHIEVEMENT_SOUND);
	PrecacheSound(SCORED_SOUND);
	//Launching plugin !
	g_nbrKilled = 0;
	Initial();
	
}

public Action:cConfig(argClient, args)
{
	PrecacheSound(ACHIEVEMENT_SOUND);
	PrecacheSound(SCORED_SOUND);
	g_nbrKilled = 0;
	Initial();
	return Plugin_Handled;
}

/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						      C O D E   O F   G A C H L 
---------------------------------------------------------------------------------*/
//Thanks for this code but i must have your code to test my plugin and i think that was bad to have
//this beautiful code ... but don't exploit it !
/*public bool:AskPluginLoad(Handle:myself, bool:late, String:error[], err_max)
{
	CreateNative("ProcessAchievement", ProcessAchievement);
	return true;
}*/

public OnMapStart()
{
	PrecacheSound(ACHIEVEMENT_SOUND);
	PrecacheSound(SCORED_SOUND);
	g_nbrKilled = 0;
	Initial();
	
}

public OnMapEnd()
{
	g_nbrKilled = 0;
}

public OnConfigsExecuted()
{
	new String:strDB[128];
	GetConVarString(cvDB, strDB, sizeof(strDB));
	if (SQL_CheckConfig(strDB))
	{
		SQL_TConnect(cDatabaseConnect, strDB);
	}
	else
	{
		LogError("Unable to open %s: No such database configuration.", strDB);
		bConnected = false;
	}
}

public PassInts(argi1, argi2, argi3, argi4)
{
	if (iCurPass == 256)
		iCurPass = 0;
	iPassInt[iCurPass][0] = argi1;
	iPassInt[iCurPass][1] = argi2;
	iPassInt[iCurPass][2] = argi3;
	iPassInt[iCurPass][3] = argi4;
	iCurPass++;
	return iCurPass-1;
}

public cDatabaseConnect(Handle:arghOwner, Handle:arghQuery, const String:argsError[], any:argData) 
{
	new String:strDB[128];
	GetConVarString(cvDB, strDB, sizeof(strDB));
	GetConVarString(cvTablePrefix, sTablePrefix, sizeof(sTablePrefix));
	if (arghQuery == INVALID_HANDLE)
	{
		LogError("Unable to connect to %s: %s", strDB, argsError);
		bConnected = false;
	}
	else
	{
		if (!SQL_FastQuery(arghQuery, "SET NAMES 'utf8'"))
		{
			LogError("Unable to change to utf8 mode.");
			bConnected = false;
		}
		else
		{
			hDatabaseConnection = arghQuery;
			bConnected = true;
		}
	}
}

public bool:IsDatabaseClosed()
{
	return !bConnected;
}

public OnClientPostAdminCheck(arghClient)
{
	SaveUser(arghClient);
}

public SaveUser(arghClient)
{
	if (IsDatabaseClosed())
		return;
	
	new String:strSteamId[128];
	new String:strName[128];
	new String:strEscapedName[128];
	GetClientAuthString(arghClient, strSteamId, sizeof(strSteamId));
	GetClientName(arghClient,strName, sizeof(strName));
	SQL_EscapeString(hDatabaseConnection, strName, strEscapedName, sizeof(strEscapedName));
	
	new String:strQuery[512];
	Format(strQuery, sizeof(strQuery), "INSERT INTO `%snames` (`steamid`, `name`) VALUES ('%s', '%s') ON DUPLICATE KEY UPDATE `name` = VALUES(`name`)", sTablePrefix, strSteamId, strEscapedName);
	
	SQL_TQuery(hDatabaseConnection, cDiscardSQL, strQuery);
}

public cDiscardSQL(Handle:arghOwner, Handle:arghQuery, const String:argsError[], any:argData) 
{
	if (arghQuery == INVALID_HANDLE)
	{
		LogError("Error in sql query: %s", argsError);
	}
}

/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						       A P I   F O N C T I O N
---------------------------------------------------------------------------------*/
public ProcessAchievement(argIdi, argClient)
{
	//LogMessage("Temps %i - Client %i",argIdi, argClient);
	new strIAchievementId = argIdi;
	new strhClient = argClient;
	new String:strQuery[512];
	if (InvalidClient(strhClient))
		return;
	if (IsDatabaseClosed())
		return;
	
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sconfig` WHERE `id` = %i;", sTablePrefix, strIAchievementId);
	SQL_TQuery(hDatabaseConnection, cCheckForValidAchievement, strQuery, PassInts(strhClient, strIAchievementId, -1, -1));
}

public cCheckForValidAchievement(Handle:arghOwner, Handle:arghQuery, const String:argsError[], any:argdata) 
{
	if (arghQuery == INVALID_HANDLE)
	{
		LogError("Error in sql query: %s", argsError);
		return;
	}
	
	if (SQL_GetRowCount(arghQuery) != 1)
	{
		LogError("Achievement %i does not exist!", iPassInt[argdata][1]);
		return;
	}
	SQL_FetchRow(arghQuery);
	new String:strQuery[512];
	new strIAchievementId = SQL_FetchInt(arghQuery, 0);
	new String:strSteamId[32];
	GetClientAuthString(iPassInt[argdata][0], strSteamId, sizeof(strSteamId));
	Format(strQuery, sizeof(strQuery), "SELECT `c`.`name`, `u`.`interval`, `c`.`amount`, `c`.`sound` FROM `%sconfig` AS `c` LEFT JOIN `%susers` AS `u` ON `c`.`id` = `u`.`aid` WHERE `u`.`steamid` = '%s' AND `id` = %i;", sTablePrefix, sTablePrefix, strSteamId, strIAchievementId);
	//PrintToServer("D E B U G : \"%s\"!", sQuery);
	SQL_TQuery(hDatabaseConnection, cProcessUserAchievement, strQuery, PassInts(iPassInt[argdata][0], iPassInt[argdata][1], SQL_FetchInt(arghQuery, 4),  -1));
}

public cProcessUserAchievement(Handle:arghOwner, Handle:arghQuery, const String:argsError[], any:argData) 
{
	if (arghQuery == INVALID_HANDLE)
	{
		LogError("Error in sql query: %s", argsError);
		return;
	}
	new strIAchievementId = iPassInt[argData][1];
	new strIUser = iPassInt[argData][0];
	new strIAchCnt = iPassInt[argData][2];
	new String:strSteamId[32];
	GetClientAuthString(strIUser, strSteamId, sizeof(strSteamId));
	SQL_FetchRow(arghQuery);
	if (SQL_GetRowCount(arghQuery) != 1)
	{
		new String:strQuery[512];
		new String:strQuery2[512];
		//VerifyofProgression(iUser, sAchievementName, iAchCnt, iUserProc);
		Format(strQuery, sizeof(strQuery), "INSERT INTO `%susers` (`steamid`, `aid`, `interval`) VALUES ('%s', %i, 1);", sTablePrefix, strSteamId, strIAchievementId);
		SQL_TQuery(hDatabaseConnection, cDiscardSQL, strQuery);
		if (strIAchCnt == 1)
		{
			Format(strQuery2, sizeof(strQuery2), "SELECT * FROM `%sconfig` WHERE `id` = %i;", sTablePrefix, strIAchievementId);
			SQL_TQuery(hDatabaseConnection, cShowAchievement, strQuery2, strIUser);
		}
		else
		{
				if(g_ClientConfigForPlugins[strIUser] != 0)
			{
				if(!StrEqual(g_ClientSteamID[strIUser], strSteamId, false))
				{
					g_ClientSteamID[strIUser]=strSteamId;
					g_ClientConfigForPlugins[strIUser] = 0;
				}
				else
				{
					new String:strMessage[200];
					new String:strMessageFile[300];
					new Handle:strhQuery2;
					Format(strQuery2, sizeof(strQuery2), "SELECT * FROM `%sconfig` WHERE `id` = %i;", sTablePrefix, strIAchievementId);
					strhQuery2 = ConnectionBD(strQuery2);
					while (SQL_FetchRow(strhQuery2))
					{
						SQL_FetchString(strhQuery2, 1, strMessage, sizeof(strMessage));
					}
					Format(strMessageFile, sizeof(strMessageFile),"%T", "First Achievements completion", LANG_SERVER);
					Format(strMessage, sizeof(strMessage), "\x01%s \x05%s", strMessageFile,strMessage);
					SayText2One(strIUser, strIUser, strMessage);
				}
			}
		}
		return;
	}
	new String:strAchievementName[128];
	SQL_FetchString(arghQuery, 0, strAchievementName, sizeof(strAchievementName));
	new strAchievementSound = SQL_FetchInt(arghQuery, 3);
	new strIUserProc = SQL_FetchInt(arghQuery, 1);
	if (strIUserProc+1 == strIAchCnt)
	{
		AchievementEffect(strIUser, strAchievementName,strAchievementSound);
		new String:strQuery[512];
		Format(strQuery, sizeof(strQuery), "UPDATE `%susers` SET `interval` = %i WHERE `steamid` = '%s' AND `aid` = %i;", sTablePrefix, strIAchCnt, strSteamId, strIAchievementId);
		SQL_TQuery(hDatabaseConnection, cDiscardSQL, strQuery);
	}
	else if (strIUserProc+1 < strIAchCnt)
	{
		new String:strQuery[512];
		VerifyofProgression(strIUser, strAchievementName, strIAchCnt, strIUserProc);
		Format(strQuery, sizeof(strQuery), "UPDATE `%susers` SET `interval` = `interval`+1 WHERE `steamid` = '%s' AND `aid` = %i;", sTablePrefix, strSteamId, strIAchievementId);
		SQL_TQuery(hDatabaseConnection, cDiscardSQL, strQuery);
	}
}

VerifyofProgression(argiUser, const String:argsAchievementName[], argAmount, argInterval)
{
	if(g_ClientConfigForPlugins[argiUser] != 0)
	{
		new String:strSteamidofclient[100];
		GetClientAuthString(argiUser, strSteamidofclient, sizeof(strSteamidofclient));
		if(!StrEqual(g_ClientSteamID[argiUser], strSteamidofclient, false))
		{
			g_ClientSteamID[argiUser]=strSteamidofclient;
			g_ClientConfigForPlugins[argiUser] = 0;
		}
		else
		{
			new String:strMessage[200];
			new String:strMessageFile[300];
			new strNewinterval = argInterval +1;
			Format(strMessageFile, sizeof(strMessageFile),"%T", "Achievements completion", LANG_SERVER);
			Format(strMessage, sizeof(strMessage), "\x05%s\x01, %s \x03%i/%i", argsAchievementName, strMessageFile,strNewinterval,argAmount);
			SayText2One(argiUser, argiUser, strMessage);
		}
	}
	new strResultat;
	new strResultat2;
	strResultat = (argInterval * 100)/argAmount;
	strResultat2 = ((argInterval+1) * 100)/argAmount;
	if(strResultat<25 && strResultat2>=25)
	{
		AchievementProgress(argiUser,argsAchievementName,"25 pourcent");
	}
	else
	{
		if(strResultat<50 && strResultat2>=50)
		{
			AchievementProgress(argiUser,argsAchievementName,"50 pourcent");
		}
		else
		{
			if(strResultat<75 && strResultat2>=75)
			{
				AchievementProgress(argiUser,argsAchievementName,"75 pourcent");
			}
		}
	}
}

AchievementProgress(argClient, const String:argName[],const String:argpourcent[])
{
	new String:strMessage[200];
	new String:strMessageFile[300];
	Format(strMessageFile, sizeof(strMessageFile),"%T", argpourcent, LANG_SERVER);
	Format(strMessage, sizeof(strMessage), "\x01%s \x03%s", strMessageFile, argName);
	SayText2One(argClient, argClient, strMessage);
}

public cShowAchievement(Handle:arghOwner, Handle:arghQuery, const String:argsError[], any:argData) 
{
	if (arghQuery == INVALID_HANDLE)
	{
		LogError("Error in sql query: %s", argsError);
		return;
	}
	SQL_FetchRow(arghQuery);
	new String:strAchievementName[128];
	SQL_FetchString(arghQuery, 1, strAchievementName, sizeof(strAchievementName));
	new strSound = SQL_FetchInt(arghQuery, 5);
	AchievementEffect(argData, strAchievementName, strSound);
}

public bool:InvalidClient(argClient)
{
	if (argClient < 1)
		return true;
	
	if (!IsClientConnected(argClient))
		return true;
	
	if (!IsClientInGame(argClient))
		return true;
	
	if (IsFakeClient(argClient))
		return true;
	
	return false;
}


/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						 C O D E   O F   L I N U X _ L O V E R
---------------------------------------------------------------------------------*/
AchievementEffect(argClient, const String:argName[], argSound)
{

	if(argSound == 0)
	{
		if (IsPlayerAlive(argClient) && IsClientConnected(argClient) && IsClientInGame(argClient))
		{
			new Float:strPlayerPos[3] ;
			GetEntPropVector(argClient, Prop_Send, "m_vecOrigin", strPlayerPos);
			EmitAmbientSound(ACHIEVEMENT_SOUND, strPlayerPos, SOUND_FROM_WORLD, SNDLEVEL_NORMAL, SND_NOFLAGS, SNDVOL_NORMAL, SNDPITCH_NORMAL, 0.0);
		}
		else
		{
			new Float:strFlVec[3];
			GetClientEyePosition(argClient, strFlVec);
			EmitAmbientSound(ACHIEVEMENT_SOUND, strFlVec, argClient, SNDLEVEL_RAIDSIREN);
		}
	}
	if(argSound == 1)
	{
			EmitSoundToClient(argClient, ACHIEVEMENT_SOUND);
	}
	
	AttachAchievementParticle(argClient);
	
	new String:strMessage[200];
	Format(strMessage, sizeof(strMessage), "\x03%N\x01 %T \x05%s", argClient, "Achievements", LANG_SERVER, argName);
	
	SayText2(argClient, strMessage);
}

AttachAchievementParticle(argClient)
{
	new strIParticle = CreateEntityByName("info_particle_system");
	
	new String:strName[128];
	if (IsValidEdict(strIParticle))
	{
		new Float:strFlPos[3];
		GetEntPropVector(argClient, Prop_Send, "m_vecOrigin", strFlPos);
		TeleportEntity(strIParticle, strFlPos, NULL_VECTOR, NULL_VECTOR);
		
		Format(strName, sizeof(strName), "target%i", argClient);
		DispatchKeyValue(argClient, "targetname", strName);
		
		DispatchKeyValue(strIParticle, "targetname", "tf2particle");
		DispatchKeyValue(strIParticle, "parentname", strName);
		DispatchKeyValue(strIParticle, "effect_name", ACHIEVEMENT_PARTICLE);
		DispatchSpawn(strIParticle);
		SetVariantString(strName);
		AcceptEntityInput(strIParticle, "SetParent", strIParticle, strIParticle, 0);
		SetVariantString("head");
		AcceptEntityInput(strIParticle, "SetParentAttachment", strIParticle, strIParticle, 0);
		ActivateEntity(strIParticle);
		AcceptEntityInput(strIParticle, "start");
		
		CreateTimer(5.0, Timer_DeleteParticles, strIParticle);
	}
}

public Action:Timer_DeleteParticles(Handle:argTimer, any:argiParticle)
{
    if (IsValidEntity(argiParticle))
    {
        new String:strClassname[256];
        GetEdictClassname(argiParticle, strClassname, sizeof(strClassname));
		
        if (StrEqual(strClassname, "info_particle_system", false))
        {
            RemoveEdict(argiParticle);
        }
    }
}

stock SayText2(argAuthor_index , const String:argMessage[] ) {
    new Handle:strBuffer = StartMessageAll("SayText2");
    if (strBuffer != INVALID_HANDLE) {
        BfWriteByte(strBuffer, argAuthor_index);
        BfWriteByte(strBuffer, true);
        BfWriteString(strBuffer, argMessage);
        EndMessage();
    }
}

stock SayText2One( argClient_index , argAuthor_index , const String:argMessage[] ) {
    new Handle:strBuffer = StartMessageOne("SayText2", argClient_index);
    if (strBuffer != INVALID_HANDLE) {
        BfWriteByte(strBuffer, argClient_index);
        BfWriteByte(strBuffer, true);
        BfWriteString(strBuffer, argMessage);
        EndMessage();
    }
}

public Action:cShowAchievements(argClient, args)
{
	new String:strAuthId[50];
	GetClientAuthString(argClient, strAuthId, sizeof(strAuthId));
	
	new String:strUrl[255];
	GetConVarString(cvURL, strUrl, sizeof(strUrl));
	
	new String:strFinal[255];
	Format(strFinal, sizeof(strFinal), "%s?u=%s", strUrl, strAuthId);
	//PrintToServer("D E B U G : \"%s\"!", strFinal)
	ShowMOTDPanel(argClient, "_:", strFinal, MOTDPANEL_TYPE_URL);
	
	return Plugin_Handled;
}

/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						 A D D   B Y   P F S M 9 9 9 - K A S A
---------------------------------------------------------------------------------*/
cShowAchievements2(argClient)
{
	new String:strAuthId[50];
	GetClientAuthString(argClient, strAuthId, sizeof(strAuthId));
	
	new String:strUrl[255];
	GetConVarString(cvURL, strUrl, sizeof(strUrl));
	
	new String:strFinal[255];
	Format(strFinal, sizeof(strFinal), "%s?u=%s", strUrl, strAuthId);
	//PrintToServer("D E B U G : \"%s\"!", strFinal)
	ShowMOTDPanel(argClient, "_:", strFinal, MOTDPANEL_TYPE_URL);
	
}

/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						 C O D E  O F  T O   T H E   R O C K 
					   A N D    M O D I F Y  B Y  P F S M 9 9 9
---------------------------------------------------------------------------------*/
//-------------------CODE OF ROCK TO THE VOTE AND MODIFY BY PFSM999------------------------
//WHEN USING THE CHAT BOX (say or say_team) "achievements" or "achievement"
//IT SHOWS THE ACHIEVEMENTS BY CALLING : cShowAchievements2
public Action:Command_Say(argClient, args)
{
	decl String:strText[192];
	new strIda_fun;
	new strCallMedic;
	new String:strSay[100];
	if (!GetCmdArgString(strText, sizeof(strText)))
	{
		return Plugin_Continue;
	}
	
	new startidx = 0;
	if(strText[strlen(strText)-1] == '"')
	{
		strText[strlen(strText)-1] = '\0';
		startidx = 1;
	}
	
	new ReplySource:old = SetCmdReplySource(SM_REPLY_TO_CHAT);
	if (strcmp(strText[startidx], "/show_achievements", true) == 0 || strcmp(strText[startidx], "/show_achievement", true) == 0)
	{
		cShowAchievements2(argClient);
		SetCmdReplySource(old);
		return Plugin_Continue;	
	}
	
	if (strcmp(strText[startidx], "/achievements", true) == 0)
	{
		SetCmdReplySource(old);
		Panel_Menu(argClient,0);
		return Plugin_Continue;	
	}
	
	SetPackPosition(g_bd_ida_fun,0);
	SetPackPosition(g_bd_say_fun,0);
	SetPackPosition(g_bd_callmedic_fun,0);
	for (new i = 0; i < g_maxAchievements_fun; i++)
	{
		strIda_fun = ReadPackCell(g_bd_ida_fun);
		strCallMedic = ReadPackCell(g_bd_callmedic_fun);
		ReadPackString(g_bd_say_fun,strSay,sizeof(strSay));
		if(strCallMedic != 1)
		{
			if(strcmp(strText[startidx], strSay, true) == 0)
			{
				ProcessAchievement(strIda_fun, argClient);
			}
		}
	}
		
	SetCmdReplySource(old);
	return Plugin_Continue;	
}

/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						 C O D E  O F  J I N D O   A N D  B Y 
						      P F S M 9 9 9 - K A S A D O R
---------------------------------------------------------------------------------*/
stock Initial()
{
	GetConVarString(cvTablePrefix, sTablePrefix, sizeof(sTablePrefix));
	decl String:strQuery[255];
	new Handle:strhQuery;
	// First try to get a database connection
	//Creating DataPacks wich will receive everything from the DB !
	g_bd_id = CreateDataPack();
	g_bd_ida = CreateDataPack();
	g_bd_victim_bool = CreateDataPack();
	g_bd_attacker_bool = CreateDataPack();
	g_bd_assister_bool = CreateDataPack();
	g_bd_victim_steamid = CreateDataPack();
	g_bd_attacker_steamid= CreateDataPack();
	g_bd_assister_steamid= CreateDataPack();
	g_bd_weapon= CreateDataPack();
	g_bd_map= CreateDataPack();
	g_bd_victim_name= CreateDataPack();
	g_bd_attacker_name= CreateDataPack();
	g_bd_assister_name= CreateDataPack();
	g_bd_domination= CreateDataPack();
	g_bd_revenge= CreateDataPack();
	g_bd_headshot= CreateDataPack();
	g_bd_backstab= CreateDataPack();
	g_bd_deadringer= CreateDataPack();
	g_bd_class= CreateDataPack();
	g_bd_class_2= CreateDataPack();
	g_bd_crits=CreateDataPack();
	g_bd_distancemoinsplusegal=CreateDataPack();
	g_bd_distance1=CreateDataPack();
	g_bd_distance2=CreateDataPack();
	g_bd_nbrKilled=CreateDataPack();
	g_bd_suicide = CreateDataPack();
	g_bd_hpmoinsplusegal = CreateDataPack();
	g_bd_hptext = CreateDataPack();
	g_bd_hptext2 = CreateDataPack();
	
	//MEDIC
	g_bd_id_medic = CreateDataPack();
	g_bd_ida_medic = CreateDataPack();
	g_bd_ubercharge_weapons = CreateDataPack();
	
	//SCOUT
	g_bd_id_scout = CreateDataPack();
	g_bd_ida_scout = CreateDataPack();
	g_bd_stunt_scout = CreateDataPack();
	g_bd_bonk_scout = CreateDataPack();
	g_bd_stuntvic_scout = CreateDataPack();
	g_bd_stuntattack_scout = CreateDataPack();
	
	//SNIPER
	g_bd_id_sniper = CreateDataPack();
	g_bd_ida_sniper = CreateDataPack();
	g_bd_ida_sniper_jarate = CreateDataPack();
	g_bd_ida_sniper_jarate_vic = CreateDataPack();
	g_bd_ida_sniper_jarate_attack = CreateDataPack();
	g_bd_ida_sniper_razor = CreateDataPack();
	g_bd_ida_sniper_razor_vic = CreateDataPack();
	g_bd_ida_sniper_razor_attack = CreateDataPack();
	
	//Engineer
	g_bd_id_engineer = CreateDataPack();
	g_bd_ida_engineer = CreateDataPack();
	g_bd_engineer_construction = CreateDataPack(); 
	g_bd_engineer_destruction = CreateDataPack(); 
	g_bd_engineer_sentry = CreateDataPack(); 
	g_bd_engineer_dispenser = CreateDataPack(); 
	g_bd_engineer_teleporterentry = CreateDataPack(); 
	g_bd_engineer_teleporterexit = CreateDataPack(); 
	g_bd_engineer_teleport = CreateDataPack(); 
	g_bd_engineer_teleport_build = CreateDataPack(); 
	g_bd_engineer_teleport_play = CreateDataPack(); 
	g_bd_engineer_des_vic = CreateDataPack(); 
	g_bd_engineer_des_attack = CreateDataPack(); 
	g_bd_engineer_des_was_build = CreateDataPack();
	
	//heavy 
	g_bd_id_heavy = CreateDataPack();
	g_bd_ida_heavy = CreateDataPack();
	g_bd_ida_heavy_own = CreateDataPack();
	g_bd_ida_heavy_notown = CreateDataPack();
	g_bd_ida_heavy_notown_target = CreateDataPack();
	g_bd_ida_heavy_notown_own = CreateDataPack();
	
	//FUN
	g_bd_id_fun = CreateDataPack();
	g_bd_ida_fun = CreateDataPack();
	g_bd_say_fun = CreateDataPack();
	g_bd_callmedic_fun = CreateDataPack();
		
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements = 0;
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida,SQL_FetchInt(strhQuery, 1));
		WritePackCell(g_bd_victim_bool,SQL_FetchInt(strhQuery, 2));
		WritePackCell(g_bd_attacker_bool,SQL_FetchInt(strhQuery, 3));
		WritePackCell(g_bd_assister_bool,SQL_FetchInt(strhQuery, 4));
		decl String:steamid[25];
		SQL_FetchString(strhQuery, 5, steamid, sizeof(steamid));
		WritePackString(g_bd_victim_steamid,steamid);
		SQL_FetchString(strhQuery, 6, steamid, sizeof(steamid));
		WritePackString(g_bd_attacker_steamid,steamid);
		SQL_FetchString(strhQuery, 7, steamid, sizeof(steamid));
		WritePackString(g_bd_assister_steamid,steamid);
		decl String:weapon[128];
		SQL_FetchString(strhQuery, 8, weapon, sizeof(weapon));
		WritePackString(g_bd_weapon,weapon);
		decl String:map[128];
		SQL_FetchString(strhQuery, 9, map, sizeof(map));
		WritePackString(g_bd_map,map);
		decl String:victime[50];
		SQL_FetchString(strhQuery, 10, victime, sizeof(victime));
		WritePackString(g_bd_victim_name,victime);
		SQL_FetchString(strhQuery, 11, victime, sizeof(victime));
		WritePackString(g_bd_attacker_name,victime);
		SQL_FetchString(strhQuery, 12, victime, sizeof(victime));
		WritePackString(g_bd_assister_name,victime);
		WritePackCell(g_bd_domination,SQL_FetchInt(strhQuery, 13));
		WritePackCell(g_bd_revenge,SQL_FetchInt(strhQuery, 14));
		WritePackCell(g_bd_headshot,SQL_FetchInt(strhQuery, 15));
		WritePackCell(g_bd_backstab,SQL_FetchInt(strhQuery, 16));
		WritePackCell(g_bd_deadringer,SQL_FetchInt(strhQuery, 17));
		SQL_FetchString(strhQuery, 18, victime, sizeof(victime));
		WritePackString(g_bd_class,victime);
		SQL_FetchString(strhQuery, 19, victime, sizeof(victime));
		WritePackString(g_bd_class_2,victime);
		WritePackCell(g_bd_crits,SQL_FetchInt(strhQuery, 20));
		WritePackCell(g_bd_distancemoinsplusegal,SQL_FetchInt(strhQuery, 21));
		SQL_FetchString(strhQuery, 22, victime, sizeof(victime));
		WritePackString(g_bd_distance1,victime);
		SQL_FetchString(strhQuery, 23, victime, sizeof(victime));
		WritePackString(g_bd_distance2,victime);
		WritePackCell(g_bd_hpmoinsplusegal,SQL_FetchInt(strhQuery, 24));
		SQL_FetchString(strhQuery, 25, victime, sizeof(victime));
		WritePackString(g_bd_hptext,victime);
		SQL_FetchString(strhQuery, 26, victime, sizeof(victime));
		WritePackString(g_bd_hptext2,victime);
		WritePackCell(g_bd_nbrKilled,SQL_FetchInt(strhQuery, 27));
		WritePackCell(g_bd_suicide,SQL_FetchInt(strhQuery, 28));
		g_maxAchievements = g_maxAchievements +1;
	}
	LogMessage("%i achievements kill charged", g_maxAchievements);
	//-----MEDIC
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver_medic`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements_medic = 0;
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id_medic,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida_medic,SQL_FetchInt(strhQuery, 1)); 
		decl String:armemedic[50];
		SQL_FetchString(strhQuery, 2, armemedic, sizeof(armemedic));
		WritePackString(g_bd_ubercharge_weapons,armemedic);
		g_maxAchievements_medic = g_maxAchievements_medic +1;
	}
	LogMessage("%i medic achievements charged", g_maxAchievements_medic);
	
	//-----SCOUT
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver_scout`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements_scout = 0;
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id_scout,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida_scout,SQL_FetchInt(strhQuery, 1)); 
		WritePackCell(g_bd_stunt_scout,SQL_FetchInt(strhQuery, 2));
		WritePackCell(g_bd_bonk_scout,SQL_FetchInt(strhQuery, 3));
		WritePackCell(g_bd_stuntvic_scout,SQL_FetchInt(strhQuery, 4));
		WritePackCell(g_bd_stuntattack_scout,SQL_FetchInt(strhQuery, 5));
		g_maxAchievements_scout = g_maxAchievements_scout+1;
	}
	LogMessage("%i scout achievements charged", g_maxAchievements_scout);
	
	//-----SNIPER
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver_sniper`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements_sniper = 0;
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id_sniper,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida_sniper,SQL_FetchInt(strhQuery, 1)); 
		WritePackCell(g_bd_ida_sniper_jarate,SQL_FetchInt(strhQuery, 2));
		WritePackCell(g_bd_ida_sniper_jarate_vic,SQL_FetchInt(strhQuery, 3));
		WritePackCell(g_bd_ida_sniper_jarate_attack,SQL_FetchInt(strhQuery, 4));
		WritePackCell(g_bd_ida_sniper_razor,SQL_FetchInt(strhQuery, 5));
		WritePackCell(g_bd_ida_sniper_razor_vic,SQL_FetchInt(strhQuery, 6));
		WritePackCell(g_bd_ida_sniper_razor_attack,SQL_FetchInt(strhQuery, 7));
		g_maxAchievements_sniper = g_maxAchievements_sniper +1;
	}
	LogMessage("%i sniper achievements charged", g_maxAchievements_sniper);
	
	//-----ENGINEER
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver_engineer`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements_engineer = 0;
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id_engineer,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida_engineer,SQL_FetchInt(strhQuery, 1)); 
		WritePackCell(g_bd_engineer_construction,SQL_FetchInt(strhQuery, 2)); 
		WritePackCell(g_bd_engineer_destruction,SQL_FetchInt(strhQuery, 3)); 
		WritePackCell(g_bd_engineer_sentry,SQL_FetchInt(strhQuery, 4));
		WritePackCell(g_bd_engineer_dispenser,SQL_FetchInt(strhQuery,5)) ;
		WritePackCell(g_bd_engineer_teleporterentry,SQL_FetchInt(strhQuery,6));
		WritePackCell(g_bd_engineer_teleporterexit,SQL_FetchInt(strhQuery,7));
		WritePackCell(g_bd_engineer_teleport,SQL_FetchInt(strhQuery,8));
		WritePackCell(g_bd_engineer_teleport_build,SQL_FetchInt(strhQuery,9));
		WritePackCell(g_bd_engineer_teleport_play,SQL_FetchInt(strhQuery,10));
		WritePackCell(g_bd_engineer_des_vic,SQL_FetchInt(strhQuery,11));
		WritePackCell(g_bd_engineer_des_attack,SQL_FetchInt(strhQuery,12));
		WritePackCell(g_bd_engineer_des_was_build,SQL_FetchInt(strhQuery,13));
		g_maxAchievements_engineer = g_maxAchievements_engineer +1;
	}
	LogMessage("%i engineer achievements charged", g_maxAchievements_engineer);
	
	//-----HEAVY
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver_heavy`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements_heavy = 0;
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id_heavy,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida_heavy,SQL_FetchInt(strhQuery, 1)); 
		WritePackCell(g_bd_ida_heavy_own,SQL_FetchInt(strhQuery, 2)); 
		WritePackCell(g_bd_ida_heavy_notown,SQL_FetchInt(strhQuery, 3)); 
		WritePackCell(g_bd_ida_heavy_notown_target,SQL_FetchInt(strhQuery, 4)); 
		WritePackCell(g_bd_ida_heavy_notown_own,SQL_FetchInt(strhQuery, 5)); 
		g_maxAchievements_heavy = g_maxAchievements_heavy +1;
	}
	LogMessage("%i heavy achievements charged", g_maxAchievements_heavy);
	
	//-----FUN
	Format(strQuery, sizeof(strQuery), "SELECT * FROM `%sserver_fun`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	g_maxAchievements_fun = 0;
	decl String:strSay[100];
	while (SQL_FetchRow(strhQuery))
	{
		WritePackCell(g_bd_id_fun,SQL_FetchInt(strhQuery, 0));
		WritePackCell(g_bd_ida_fun,SQL_FetchInt(strhQuery, 1)); 
		SQL_FetchString(strhQuery, 2, strSay, sizeof(strSay));
		WritePackString(g_bd_say_fun,strSay);
		WritePackCell(g_bd_callmedic_fun,SQL_FetchInt(strhQuery, 3)); 
		g_maxAchievements_fun = g_maxAchievements_fun +1;
	}
	LogMessage("%i fun achievements charged", g_maxAchievements_fun);
	
	for (new i = 0; i <= MAXPLAYERS; i++)
	{
		g_ClientConfigForPlugins[i] = 0;
		g_ClientSteamID[i] = "";
	}
}

public Action:eCheckFile(Handle:argEvent, const String:argName[], bool:argNoBroadcast)
{
	
	g_victim = GetClientOfUserId(GetEventInt(argEvent, "userid"));
	g_attacker = GetClientOfUserId(GetEventInt(argEvent, "attacker"));
	GetEventString(argEvent, "weapon_logclassname", g_weapon, sizeof(g_weapon));
	g_customkill = GetEventInt(argEvent, "customkill");
	g_deadringer =  GetEventInt(argEvent, "death_flags");
	//g_headshot = GetEventBool(argEvent, "headshot");
	if((g_deadringer & 1) || (g_deadringer & 2) )
		g_domination = 1;
	else
		g_domination = 0;
		
	if((g_deadringer & 4) || (g_deadringer & 8) )
		g_revenge = 1;
	else
		g_revenge = 0;
	
	g_assister = GetClientOfUserId(GetEventInt(argEvent, "assister"));
	g_damagebits = GetEventInt(argEvent, "damagebits");
	g_nbrKilled = g_nbrKilled + 1;
	
	if (g_deadringer & 32)
	{
		g_deadringer = 1;	
	}
	else
	{
		g_deadringer = 0;	
	}
	GetCurrentMap(g_map,sizeof(g_map));
		
	SetPackPosition(g_bd_id,0);
	SetPackPosition(g_bd_ida,0);
	SetPackPosition(g_bd_victim_bool,0);
	SetPackPosition(g_bd_attacker_bool,0);
	SetPackPosition(g_bd_assister_bool,0);
	SetPackPosition(g_bd_victim_steamid,0);
	SetPackPosition(g_bd_attacker_steamid,0);
	SetPackPosition(g_bd_assister_steamid,0);
	SetPackPosition(g_bd_weapon,0);
	SetPackPosition(g_bd_map,0);
	SetPackPosition(g_bd_victim_name,0);
	SetPackPosition(g_bd_attacker_name,0);
	SetPackPosition(g_bd_assister_name,0);
	SetPackPosition(g_bd_domination,0);
	SetPackPosition(g_bd_revenge,0);
	SetPackPosition(g_bd_headshot,0);
	SetPackPosition(g_bd_backstab,0);
	SetPackPosition(g_bd_deadringer,0);
	SetPackPosition(g_bd_class,0);
	SetPackPosition(g_bd_class_2,0);
	SetPackPosition(g_bd_crits,0);
	SetPackPosition(g_bd_distancemoinsplusegal,0);
	SetPackPosition(g_bd_distance1,0);
	SetPackPosition(g_bd_distance2,0);
	SetPackPosition(g_bd_nbrKilled,0);
	SetPackPosition(g_bd_suicide,0);
	SetPackPosition(g_bd_hpmoinsplusegal,0);
	SetPackPosition(g_bd_hptext,0);
	SetPackPosition(g_bd_hptext2,0);

	for (new i = 0; i < g_maxAchievements; i++)
	{
		new ach_id = CompareConditions(i);
		if (ach_id != 0)
		{
			if (g_target == 0)
			{
				ProcessAchievement(ach_id, g_attacker);
				//LogMessage("+1 of the achivement : %u",ach_id);
			} else {
				if(g_target == 1)
				{
					ProcessAchievement(ach_id, g_victim);
					//LogMessage("+1 of the achivement : %u",ach_id);
				}
				else
				{
					ProcessAchievement(ach_id, g_assister);
					//LogMessage("+1 of the achivement : %u",ach_id);
				}
			}
		}
		else
		{
				//LogMessage("Dommage");
		}
	}
	
	return Plugin_Handled;
}

stock CompareConditions(aid)
{
			
		// GENERAL
		//LogMessage("Achivement numéro 1 : %i",aid);
		new aidi = ReadPackCell(g_bd_ida);
		//LogMessage("Achivement numéro BD : %i",aidi);
		new attacker = g_attacker;
		new victim = g_victim;
		new assister = g_assister;
		new suicide = 0;
		// WEAPON DETAIL
		
		new customkill = g_customkill;
		new kvHeadshot = ReadPackCell(g_bd_headshot);
		new kvBackstab = ReadPackCell(g_bd_backstab);
		new kvDominated = ReadPackCell(g_bd_domination);
		new kvRevenge = ReadPackCell(g_bd_revenge);
		new kvCrits = ReadPackCell(g_bd_crits);
		new kvNbrKill = ReadPackCell(g_bd_nbrKilled);
		new kvSuicide = ReadPackCell(g_bd_suicide);
		new kv_attacker = ReadPackCell(g_bd_attacker_bool);
		new kv_victim = ReadPackCell(g_bd_victim_bool);
		new kv_assist = ReadPackCell(g_bd_assister_bool);
		new kvTarget;
		new kv_Vieattacker;
		new TFClassType:class;
		new TFClassType:class_2;
		
		
		if(victim == 0 && assister == 0 || (attacker == victim))
		{
			suicide=1;
			//LogMessage("suicide custom 1 " );
		}
		if(g_damagebits & DMG_NERVEGAS || g_damagebits & DMG_VEHICLE || g_damagebits & DMG_FALL)
		{
			//LogMessage("suicide custom 2 " );
			suicide=1;
		}
		
		//------------------------------
		//LogMessage("Passer : %i",aidi );
		if(suicide!=1)
		{
			if(kv_victim==1)
			{
				kvTarget=1;
				if (victim == 0)
				{
					return 0;
				}
				if (attacker != 0)
				{
					class_2 =  TF2_GetPlayerClass(attacker);
					class = TF2_GetPlayerClass(victim);
				}
			}
			else
			{
				if(kv_attacker==1)
				{
					kvTarget=0;
					if (attacker == 0)
					{
						return 0;
					}
					if (victim != 0)
					{
						kv_Vieattacker = GetClientHealth(attacker)
						class =  TF2_GetPlayerClass(attacker);
						class_2 =  TF2_GetPlayerClass(victim);
					}
				}
				else
				{
					if(kv_assist==1)
					{
						kvTarget=2;
						if(assister ==0)
						{
							return 0;
						}
						else
						{
							class =  TF2_GetPlayerClass(assister);
							class_2 =  TF2_GetPlayerClass(attacker);
						}
					}
				}
			}
		}
		else
		{
			kvTarget=1;
			if(victim !=0)
			{
				class =  TF2_GetPlayerClass(victim);
			}
			else
			{
				return 0;
			}
		}
		
		//LogMessage("g_class : %s",g_class );
		//LogMessage("kvTarget : %i",kvTarget );
		
		new kvdeadringer = ReadPackCell(g_bd_deadringer);
		g_target = kvTarget;
		
		// NAME STUFF
		
		decl String:victimName[256];
		GetClientName(victim, victimName, sizeof(victimName));
		decl String:attackName[256];
		GetClientName(attacker, attackName, sizeof(attackName));
		decl String:assisterName[256];
		GetClientName(assister, assisterName, sizeof(assisterName));
		
		decl String:kvVictName[50];
		ReadPackString(g_bd_victim_name,kvVictName,sizeof(kvVictName));

		decl String:kvAtckName[50];
		ReadPackString(g_bd_attacker_name,kvAtckName,sizeof(kvAtckName));
		
		decl String:kvAssistName[50];
		ReadPackString(g_bd_assister_name,kvAssistName,sizeof(kvAssistName));
		// STEAM ID STUFF
		
		decl String:victimID[256];
		GetClientAuthString(victim, victimID, sizeof(victimID));
		
		decl String:attackID[256];
		if(attacker!=0)
			GetClientAuthString(attacker, attackID, sizeof(attackID));
		
		decl String:assisteID[256];
		if(assister!=0)
			GetClientAuthString(assister, assisteID, sizeof(assisteID));
		
		decl String:kvVictimID[256];
		ReadPackString(g_bd_victim_steamid,kvVictimID,sizeof(kvVictimID));
		
		decl String:kvAtckerID[256];
		ReadPackString(g_bd_attacker_steamid,kvAtckerID,sizeof(kvAtckerID));
		
		decl String:kvAssisteID[256];
		ReadPackString(g_bd_assister_steamid,kvAssisteID,sizeof(kvAssisteID));
		
		// WEAPON STUFF
		decl String:weapon[128];
		strcopy(weapon, sizeof(weapon), g_weapon);
		decl String:kvWeapon[128];
		ReadPackString(g_bd_weapon,kvWeapon,sizeof(kvWeapon));
				
		// MAP NAME
		decl String:map[32];
		strcopy(map, sizeof(map), g_map);
		decl String:kvMap[32];
		ReadPackString(g_bd_map,kvMap,sizeof(kvMap));
		
		// CLASS NAME
		decl String:kvClass[32];
		ReadPackString(g_bd_class,kvClass,sizeof(kvClass));
		
		// CLASS NAME
		decl String:kvClass_2[32];
		ReadPackString(g_bd_class_2,kvClass_2,sizeof(kvClass_2));
		new Float:victimLoc[3], Float:attackerLoc[3], Float:distanceFloat;
		new distance;

		if(attacker!=0)
		{
			GetClientAbsOrigin(victim,victimLoc);
			GetClientAbsOrigin(attacker,attackerLoc);
			distanceFloat= FloatDiv(calcDistance(victimLoc[0],attackerLoc[0], victimLoc[1],attackerLoc[1], victimLoc[2],attackerLoc[2]), 32.0);
			GetClientAbsOrigin(attacker,attackerLoc);
			//LogMessage("distance : %i",distance);
			distanceFloat = distanceFloat * 0.305; //1ft = .305 meters
			new String:DistanceVrai[50];
			Format(DistanceVrai, sizeof(DistanceVrai), "%.1f", distanceFloat);
			//distance  = StringToInt(DistanceVrai);
			distance  = StringToInt(DistanceVrai);
			//LogMessage("distance String: %s",DistanceVrai);
			//LogMessage("distance Int: %i",distance);
			//LogMessage("distance Float: %f",StringToFloat(DistanceVrai));
			//LogMessage("kv_Vieattacker : %i",kv_Vieattacker);
		}
		new KvDistanceMoinsPlus=ReadPackCell(g_bd_distancemoinsplusegal);
		decl String:KvDistance1[32];
		decl String:KvDistance2[32];
		ReadPackString(g_bd_distance1,KvDistance1,sizeof(KvDistance1));
		ReadPackString(g_bd_distance2,KvDistance2,sizeof(KvDistance2));
		
		decl String:KvHP1[32];
		decl String:KvHP2[32];

		new KvHP =ReadPackCell(g_bd_hpmoinsplusegal);
		ReadPackString(g_bd_hptext,KvHP1,sizeof(KvHP1));
		ReadPackString(g_bd_hptext2,KvHP2,sizeof(KvHP2));
		
		// THE COMPARISON
		if(kvSuicide != suicide)
		{
			return 0;
		}
		
		// WEAPONS
		
		if (!CompareWeapons(kvWeapon, weapon, customkill, kvHeadshot, kvBackstab))
		{
			//LogMessage("Dommage kvWeapon = %s, weapon= %s",kvWeapon,weapon);
			return 0;
		}
		
		//MAP
		if (!CompareMap(kvMap, map))
		{
			//LogMessage("Dommage : 3");
			return 0;
		}
		
		// STEAM ID

		if (!CompareSteamIDs(kvVictimID, victimID))
		{
			//LogMessage("Dommage : 5");
			return 0;
		}
		
		if(attacker !=0)
		{
			if (!CompareSteamIDs(kvAtckerID, victimID))
			{
				//LogMessage("Dommage : 4");
				return 0;
			}
		}
		
		if(assister !=0)
		{
			if (!CompareSteamIDs(kvAssisteID, assisteID))
			{
				//LogMessage("Dommage : 6");
				return 0;
			}
		}
		
		// NAME CONTAINS
		
		if (!CompareNames(kvVictName, victimName))
		{
			//LogMessage("Dommage : 7");
			return 0;
		}
		
		if(attacker !=0)
		{
			if (!CompareNames(kvAtckName, attackName))
			{
				//LogMessage("Dommage : 8");
				return 0;
			}
		}
		
		if(assister !=0)
		{
			if (!CompareNames(kvAssistName, assisterName))
			{
				//LogMessage("Dommage : 8");
				return 0;
			}
		}
		
		//DOMINATED
		if(kvDominated != -1)
		{
			if (!CompareDominated(kvDominated, g_domination))
			{
				//LogMessage("Dommage : 9");
				return 0;
			}
		}
		
		//REVENGE
		if(kvRevenge != -1)
		{
			if (!CompareRevenge(kvRevenge, g_revenge))
			{
				//LogMessage("Dommage : 10");
				return 0;
			}
		}
		
		//DEAD RINGER
		if(kvdeadringer != -1)
		{
			if (g_deadringer != kvdeadringer)
			{
				//LogMessage("Dommage : 11");
				return 0;
			}
			
			if (g_deadringer == 1)
				g_target = 1;
		}
		//CLASS
		
		if (!CompareClass(kvClass, class))
		{
			//LogMessage("Dommage : 12");
			return 0;
		}
		
		if (!CompareClass(kvClass_2, class_2))
		{
			//LogMessage("Dommage : 12 Bis");
			return 0;
		}
		
		/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						 A D D   T O   V E R S I O N   V 0 . 4
		---------------------------------------------------------------------------------*/
		//Distance
		if(suicide!=1 && attacker != 0)
		{
			if(KvDistanceMoinsPlus != -1)
			{
				if (!StrEqual(KvDistance1, "any", false) && (KvDistanceMoinsPlus==1 || KvDistanceMoinsPlus==2))
				{
					if (!CompareDistance(StringToInt(KvDistance1), distance, KvDistanceMoinsPlus))
					{
						//LogMessage("Dommage : 13");
						return 0;
					}
				}
				else
				{
					if (!StrEqual(KvDistance1, "any", false) && !StrEqual(KvDistance2, "any", false) && KvDistanceMoinsPlus == 3)
					{
						if (!CompareDistance2(StringToInt(KvDistance1),StringToInt(KvDistance2), distance))
						{
							//LogMessage("Dommage : 14");
							return 0;
						}
					}
				}
			}
		}
		
		/*---------------------------------------------------------------------------------
				         C U S T O M   A C H I E V E M E N T S
						 A D D   T O   V E R S I O N   V 0 . 6
		---------------------------------------------------------------------------------*/
		//HP
		if(suicide!=1 && attacker != 0)
		{
			if(KvHP != -1)
			{
				if (!StrEqual(KvHP1, "any", false) && (KvHP==1 || KvHP==2))
				{
					if (!CompareHP(StringToInt(KvHP1), kv_Vieattacker, KvHP))
					{
						//LogMessage("Dommage : 13");
						return 0;
					}
				}
				else
				{
					if (!StrEqual(KvHP1, "any", false) && !StrEqual(KvHP2, "any", false) && KvHP == 3)
					{
						if (!CompareHP2(StringToInt(KvHP1),StringToInt(KvHP2), kv_Vieattacker))
						{
							//LogMessage("Dommage : 14");
							return 0;
						}
					}
				}
			}
		}
		//critics
		if(kvCrits == 1)
		{
			if (!(g_damagebits & DF_CRITS))
			{
				return 0;
			}
		}
		
		//NbrKilled
		if(kvNbrKill!=0)
		{
			if(g_nbrKilled != kvNbrKill)
			{
				//LogMessage("Dommage : 16");
				return 0;
			}
		}
		
		return aidi;
}

Float:calcDistance(Float:x1,Float:x2,Float:y1,Float:y2,Float:z1,Float:z2){ 
	new Float:dx = x1-x2;
	new Float:dy = y1-y2;
	new Float:dz = z1-z2;
	return(SquareRoot(dx*dx + dy*dy + dz*dz));
}

stock bool:CompareDistance(KvDistance,distance,KvDistanceMoinsPlusEgal)
{
	//More than (+)
	//LogMessage("KvDistance == %i", KvDistance);
	//LogMessage("distance == %i", distance);
	//LogMessage("KvDistanceMoinsPlusEgal == %i", KvDistanceMoinsPlusEgal);
	if (KvDistanceMoinsPlusEgal==1)
	{
		if(distance<KvDistance)
		{
			return true;
		}
		else
		{
			return false;
		}
	}
	else 
	{
		//Less than (-)
		if(KvDistanceMoinsPlusEgal == 2)
		{
			if(distance>KvDistance)
			{
				return true;
			}
			else
			{
				return false;
			}
		}
	}
	return true;
}

stock bool:CompareDistance2(KvDistance,KvDistance2,distance)
{
	//Between
	if(KvDistance<distance && distance<KvDistance2 )
	{
		return true;
	}
	else
	{
		return false;
	}

}

stock bool:CompareHP(KvHP1,HP,KvHP)
{
	//More than (+)
	//LogMessage("KvHP == %i", KvHP);
	//LogMessage("HP == %i", HP);
	//LogMessage("KvHP1 == %i", KvHP1);
	if (KvHP==1)
	{
		if(HP<KvHP1)
		{
			return true;
		}
		else
		{
			return false;
		}
	}
	else 
	{
		//Less than (-)
		if(KvHP == 2)
		{
			if(HP>KvHP1)
			{
				return true;
			}
			else
			{
				return false;
			}
		}
	}
	return true;
}

stock bool:CompareHP2(KvHP1,KvHP2,HP)
{
	//Between
	if(KvHP1<HP && HP<KvHP2 )
	{
		return true;
	}
	else
	{
		return false;
	}

}

stock bool:CompareDominated(kv_domination,event_domination)
{
	if(kv_domination != event_domination)
	{
		return false;
	}
	return true;
}

stock bool:CompareMap(const String:kv_map[],const String:event_map[])
{
	if (!StrEqual(kv_map, "any", false))
	{
		
		if (!StrEqual(kv_map, event_map, false))
		{
			return false;
		}
		
	}
	return true;
}

stock bool:CompareClass(const String:kv_class[],const TFClassType:event_class)
{
	if (!StrEqual(kv_class, "any", false))
	{
		
		if (event_class != TF2_GetClass(kv_class))
		{
			return false;
		}
		
	}
	return true;
}


stock bool:CompareRevenge(kv_revenge,event_revenge)
{
	if(kv_revenge != event_revenge)
	{
		return false;
	}
	return true;
}

stock bool:CompareWeapons(const String:kv_weapon[], const String:event_weapon[], event_customkill, kv_headshot, kv_backstab)
{
	if (!StrEqual(kv_weapon, "any", false))
	{
		if(StrEqual(kv_weapon, "saw", false))
		{
			if(!(g_damagebits & DMG_NERVEGAS))
			{
				return false;
			}
		}
		else
		{
			if(StrEqual(kv_weapon, "train", false))
			{
				if(!(g_damagebits & DMG_VEHICLE))
				{
					return false;
				}
			}
			else
			{
				if (!StrEqual(kv_weapon, event_weapon, false))
				{
					return false;
				}
			}
		}
	}
	if(kv_headshot != -1)
	{
		if (kv_headshot == 1 && event_customkill != 1)
			return false;
		if(kv_headshot == 0 && event_customkill == 1)
			return false;
	}
	
	if(kv_backstab != -1)
	{
		if (kv_backstab == 1 && event_customkill != 2)
			return false;
		if (kv_backstab == 0 && event_customkill == 2)
			return false;
	}
	
	return true;
}

stock bool:CompareSteamIDs(const String:kv_steamid[], const String:event_steamid[])
{
	if (!StrEqual(kv_steamid, "any", false))
	{
		if (!StrEqual(kv_steamid, event_steamid, false))
		{
			return false;
		}
		return true;
	}
	return true;
}

stock bool:CompareNames(const String:kv_namecon[], const String:argEvent_name[])
{
	if (!StrEqual(kv_namecon, "any", false))
	{
		if (!StrContains(argEvent_name, kv_namecon, true))
		{
			return false;
		}
		return true;
	}
	return true;
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
				 A D D   T O   V E R S I O N   V 0 . 3
---------------------------------------------------------------------------------*/
//To create a panel with your achievements done and others.
public PanelHandler1(Handle:argMenu, MenuAction:argAction, argParam1, argParam2)
{
	if (argAction == MenuAction_Select)
	{
		if (argParam2 == 1)
		{
			Panel_Menu_Option1(argParam1);
		}
		if (argParam2 == 2)
		{
			Panel_Menu_Option2(argParam1)
		}
		if (argParam2 == 3)
		{
			new String:strSteamidofclient[100];
			GetClientAuthString(argParam1, strSteamidofclient, sizeof(strSteamidofclient));
			if(!StrEqual(g_ClientSteamID[argParam1], strSteamidofclient, false))
			{
				g_ClientSteamID[argParam1]=strSteamidofclient;
				g_ClientConfigForPlugins[argParam1] = 0;
			}
			if(g_ClientConfigForPlugins[argParam1] == 0)
				g_ClientConfigForPlugins[argParam1] = 1;
			else
				g_ClientConfigForPlugins[argParam1] = 0;
				
			Panel_Menu(argParam1,0);
		}
		if (argParam2 == 4)
		{
			Panel_Menu_Option4(argParam1)
		}
		if (argParam2 == 5)
		{
		}
	}
}

public PanelHandler2(Handle:argMenu, MenuAction:argAction, argParam1, argParam2)
{
	if (argAction == MenuAction_Select)
	{
		if (argParam2 != 0)
		{
			new String:strInfo[100];
			GetMenuItem(argMenu, argParam2, strInfo, sizeof(strInfo));
			SayAchievementCaracteristic(strInfo, argParam1);
		}
	} else if (argAction == MenuAction_Cancel) {
		Panel_Menu(argParam1,0);
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
			     C A R A C T   A C H I E V E M E N T S
---------------------------------------------------------------------------------*/

public SayAchievementCaracteristic(const String:argEvent_name[], argClient)
{
	new String:strSteamidofclient[100];
	decl String:strQuery[500];
	new Handle:strhQuery;
	GetClientAuthString(argClient, strSteamidofclient, sizeof(strSteamidofclient));
	
	//Number of achievements
	Format(strQuery, sizeof(strQuery), "SELECT `b`.`amount`, `a`.`interval`, `b`.`description` FROM `%sconfig` b ,`%susers` a WHERE `b`.`name` = \"%s\" and `a`.`steamid`='%s' and `b`.`id` = `a`.`aid`;",sTablePrefix,sTablePrefix, argEvent_name, strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	
	new String:strMessageToSay[500];
	new String:strExplicationSQL[200];
	new String:strExplication[200];
	if (SQL_GetRowCount(strhQuery) > 0)
	{
		while (SQL_FetchRow(strhQuery))
		{
			Format(strMessageToSay, sizeof(strMessageToSay), "\x05%s  - \x01(%i/%i) : ", argEvent_name, SQL_FetchInt(strhQuery, 1),SQL_FetchInt(strhQuery, 0));
			SayText2One(argClient, argClient, strMessageToSay);
			SQL_FetchString(strhQuery, 2, strExplicationSQL, sizeof(strExplicationSQL));
			Format(strExplication, sizeof(strExplication), "%T", "Explication", LANG_SERVER);
			Format(strMessageToSay, sizeof(strMessageToSay), "%s : \x03%s", strExplication,strExplicationSQL);
			SayText2One(argClient, argClient, strMessageToSay);
		}
	}
	else
	{
		Format(strQuery, sizeof(strQuery), "SELECT `amount`, `description` FROM `%sconfig` b WHERE `name` = '%s';",sTablePrefix, argEvent_name);
		strhQuery = ConnectionBD(strQuery);
		while (SQL_FetchRow(strhQuery))
		{
			Format(strMessageToSay, sizeof(strMessageToSay), "\x05%s  - \x01(0/%i) : ", argEvent_name, SQL_FetchInt(strhQuery, 0));
			SayText2One(argClient, argClient, strMessageToSay);
			SQL_FetchString(strhQuery, 1, strExplicationSQL, sizeof(strExplicationSQL));
			Format(strExplication, sizeof(strExplication), "%T", "Explication", LANG_SERVER);
			Format(strMessageToSay, sizeof(strMessageToSay), "%s : \x03%s", strExplication,strExplicationSQL);
			SayText2One(argClient, argClient, strMessageToSay);
		}
	}
}

Handle:ConnectionBD(const String:strQuery[])
{
	new Handle:db;
	new String:sDB[128];
	new Handle:strhQuery;
	decl String:error[255];
	GetConVarString(cvDB, sDB, sizeof(sDB));
	db = SQL_Connect(sDB, true, error, sizeof(error));
	if (db == INVALID_HANDLE)
	{
		LogError("Could not connect to database \"%s\": %s", sDB, error);
		return INVALID_HANDLE;
	}
	if ((strhQuery = SQL_Query(db, strQuery)) == INVALID_HANDLE)
	{
		SQL_GetError(db, error, sizeof(error));
		LogError("'Count query' failed: %s", strQuery);
		LogError("Query error: %s", error);
		return INVALID_HANDLE;
	}
	CloseHandle(db);
	return strhQuery;
	
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
			   O P T I O N 1  :  S H O W   C U S T O M S 
			     A C H I E V E M E N T S       D O N E 
---------------------------------------------------------------------------------*/
public Panel_Menu_Option1(argClient)
{
	new String:strMessageTitle[255];
	new String:strAch_Title[255];
	new String:strName[32];
	decl String:strQuery[500];
	new Handle:strhQuery;
	new String:strExit[255];
	new strNumberachievement;
	new strNumberachievementdone;
	new String:strSteamidofclient[100];
	new Handle:strPanel;
	
	GetClientName(argClient, strName, sizeof(strName));
	GetClientAuthString(argClient, strSteamidofclient, sizeof(strSteamidofclient));
	//SQL
	//Number of achievements
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(*) FROM `%sconfig`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievement = SQL_FetchInt(strhQuery, 0);
	}
	//Number of achievements of the player
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(`a`.`aid`) FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` = `b`.`amount` and `a`.`aid` = `b`.`id` ) ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievementdone = SQL_FetchInt(strhQuery, 0);
	}
	Format(strMessageTitle, sizeof(strMessageTitle), "%T", "Option show achievements of Menu", LANG_SERVER, strNumberachievementdone,strNumberachievement);
	Format(strQuery, sizeof(strQuery), "SELECT `b`.`name` FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` = `b`.`amount` and `a`.`aid` = `b`.`id` )  ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	if (SQL_GetRowCount(strhQuery) == 0)
	{
		strPanel =  CreatePanel();
		Format(strAch_Title, sizeof(strAch_Title), "%T", "No achievement done", LANG_SERVER);
		DrawPanelText(strPanel,strAch_Title);
		DrawPanelItem(strPanel, strExit);
		Format(strExit, sizeof(strExit), "%T", "Retour", LANG_SERVER);
		SetMenuTitle(strPanel, strMessageTitle);
		SendPanelToClient(strPanel, argClient, PanelHandlerNULL, 20);
	}
	else
	{
		strPanel = CreateMenu(PanelHandler1);
		while (SQL_FetchRow(strhQuery))
		{
			SQL_FetchString(strhQuery, 0, strAch_Title, sizeof(strAch_Title));
			AddMenuItem(strPanel,strAch_Title,strAch_Title);
		}
		SetMenuTitle(strPanel, strMessageTitle);
		DisplayMenu(strPanel,argClient,20);
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
			      R E T U R N  T O  M A I N   M E N U
---------------------------------------------------------------------------------*/
public PanelHandlerNULL (Handle:argMenu, MenuAction:argAction, argParam1, argParam2)
{
	if (argAction == MenuAction_Select)
	{
		if (argParam2 != 0)
		{
			Panel_Menu(argParam1,0);
		}
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
		   D E L E T E   A C H I E V E M E N T S  B E F O R E 
---------------------------------------------------------------------------------*/
public PanelHandler3 (Handle:argMenu, MenuAction:argAction, argParam1, argParam2)
{
if (argAction == MenuAction_Select)
	{
		if (argParam2 != 0)
		{
			new String:info[100];
			GetMenuItem(argMenu, argParam2, info, sizeof(info));
			DeleteConfirmationAchievement(info, argParam1);
		}
	} else if (argAction == MenuAction_Cancel) {
		Panel_Menu(argParam1,0);
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
		     D E L E T E   A C H I E V E M E N T S   A F T E R
---------------------------------------------------------------------------------*/
public PanelHandler31 (Handle:argMenu, MenuAction:argAction, argParam1, argParam2)
{
if (argAction == MenuAction_Select)
	{
		if (argParam2 == 1)
		{
			DeleteAchievement(g_ClientDeleteAchievement[argParam1], argParam1);
		}
		if (argParam2 == 3)
		{
			Panel_Menu(argParam1,0);
		}
	}
}


/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
		     D E L E T E   A C H I E V E M E N T   C O N F 
---------------------------------------------------------------------------------*/
public DeleteConfirmationAchievement(const String:argEvent_name[], argClient)
{
	new String:strMessageTitle[255];
	new String:strYes[255];
	new String:strNo[255];
	new String:strReturn[255];
	new String:strAchName[300];
	
	Format(strAchName,sizeof(strAchName),"%s",argEvent_name);
	Format(strMessageTitle,sizeof(strMessageTitle),"%T","Delete confirmation", LANG_SERVER);
	Format(strYes,sizeof(strYes),"%T","Yes", LANG_SERVER);
	Format(strNo,sizeof(strNo),"%T","No", LANG_SERVER);
	Format(strReturn, sizeof(strReturn), "%T", "Retour", LANG_SERVER);
	
	new Handle: strPanel_confirm = CreatePanel();
	SetPanelTitle(strPanel_confirm, strMessageTitle);
	DrawPanelItem(strPanel_confirm, strYes);
	DrawPanelItem(strPanel_confirm, strNo);
	DrawPanelItem(strPanel_confirm, strReturn);
	
	SendPanelToClient(strPanel_confirm, argClient, PanelHandler31, 20);
	CloseHandle(strPanel_confirm);
	
	g_ClientDeleteAchievement[argClient] = strAchName;
}


/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
		         D E L E T E   A C H I E V E M E N T 
---------------------------------------------------------------------------------*/
public DeleteAchievement(const String:argEvent_name[], argclient)
{
	new String:strSteamidofclient[100];
	decl String:strQuery[500];
	new Handle:strhQuery;
	new String:strMessage[500]; 
	new String:strMessageToSay[500]; 
	GetClientAuthString(argclient, strSteamidofclient, sizeof(strSteamidofclient));
	
	//Number of achievements
	Format(strQuery, sizeof(strQuery), "SELECT `b`.`id`, `b`.`amount`, `a`.`interval`, `b`.`description` FROM `%sconfig` b ,`%susers` a WHERE `b`.`name` = \"%s\" and `a`.`steamid`='%s' and `b`.`id` = `a`.`aid`;",sTablePrefix,sTablePrefix, argEvent_name, strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	if (SQL_GetRowCount(strhQuery) > 0)
	{
		while (SQL_FetchRow(strhQuery))
		{
			new strIdofachievement = SQL_FetchInt(strhQuery, 0);
			Format(strQuery, sizeof(strQuery), "DELETE FROM `%susers` WHERE `aid` = %i and steamid = '%s';",sTablePrefix,strIdofachievement,strSteamidofclient);
			ConnectionBD(strQuery);
			//SQL_FetchRow(strhQuery2);
			
			Format(strMessage, sizeof(strMessage), "%T", "Deleting ok", LANG_SERVER);
			Format(strMessageToSay, sizeof(strMessageToSay), "\x01%s \x05%s : ",strMessageToSay,argEvent_name);
			SayText2One(argclient, argclient, strMessageToSay);
		}
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
			   O P T I O N 2  :  S H O W   C U S T O M S 
			    A C H I E V E M E N T S  N O T  D O N E 
---------------------------------------------------------------------------------*/
public Panel_Menu_Option2(argclient)
{
	new String:strMessageTitle[255];
	new String:strAch_Title[255];
	new String:strName[32];
	decl String:strQuery[500];
	new Handle:strhQuery;
	new String:strExit[255];
	new strNumberachievement;
	new strNumberachievementdone;
	new String:strSteamidofclient[100];
	new Handle:strPanel;
	GetClientName(argclient, strName, sizeof(strName));
	GetClientAuthString(argclient, strSteamidofclient, sizeof(strSteamidofclient));
	//SQL

	//Number of achievements
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(*) FROM `%sconfig`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievement = SQL_FetchInt(strhQuery, 0);
	}
	
	//Number of achievements of the player
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(`a`.`aid`) FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` = `b`.`amount` and `a`.`aid` = `b`.`id` ) ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievementdone = SQL_FetchInt(strhQuery, 0);
		strNumberachievementdone = strNumberachievement - strNumberachievementdone;
	}

	Format(strMessageTitle, sizeof(strMessageTitle), "%T", "Option show achievements no done of Menu", LANG_SERVER, strNumberachievementdone,strNumberachievement);
	Format(strQuery, sizeof(strQuery), "SELECT `b`.`name` FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` <> `b`.`amount` AND `b`.`id` = `a`.`aid`) ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	if (SQL_GetRowCount(strhQuery) == strNumberachievement)
	{
		Format(strAch_Title, sizeof(strAch_Title), "%T", "All achievement done", LANG_SERVER);
		strPanel =  CreatePanel();
		DrawPanelText(strPanel,strAch_Title);
		DrawPanelItem(strPanel, strExit);
		Format(strExit, sizeof(strExit), "%T", "Retour", LANG_SERVER);
		SetMenuTitle(strPanel, strMessageTitle);
		SendPanelToClient(strPanel, argclient, PanelHandlerNULL, 20);
	}
	else
	{
		strPanel = CreateMenu(PanelHandler2);
		if (SQL_GetRowCount(strhQuery) > 0)
		{
			while (SQL_FetchRow(strhQuery))
			{
				SQL_FetchString(strhQuery, 0, strAch_Title, sizeof(strAch_Title));
				AddMenuItem(strPanel,strAch_Title,strAch_Title);
			}
		}
		Format(strQuery, sizeof(strQuery), "SELECT `name` FROM `%sconfig` WHERE `id` not in (SELECT DISTINCT(`aid`) FROM `%susers` WHERE `steamid` = '%s') ;",sTablePrefix,sTablePrefix,strSteamidofclient);
		strhQuery = ConnectionBD(strQuery);
		while (SQL_FetchRow(strhQuery))
		{
			SQL_FetchString(strhQuery, 0, strAch_Title, sizeof(strAch_Title));
			AddMenuItem(strPanel,strAch_Title,strAch_Title);
		}
		SetMenuTitle(strPanel, strMessageTitle);
		DisplayMenu(strPanel,argclient,20);
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
				     V 0 . 6           O P T I O N 3 
			      D E L E T E    A C H I E V E M E N T 
---------------------------------------------------------------------------------*/
public Panel_Menu_Option4(argClient)
{
	new String:strMessageTitle[255];
	new String:strAch_Title[255];
	new String:strName[32];
	decl String:strQuery[500];
	new Handle:strhQuery;
	new String:strExit[255];
	
	new strNumberachievement;
	new strNumberachievementdone;
	new String:strSteamidofclient[100];
	GetClientName(argClient, strName, sizeof(strName));
	GetClientAuthString(argClient, strSteamidofclient, sizeof(strSteamidofclient));
	//SQL
	//Number of achievements
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(*) FROM `%sconfig`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievement = SQL_FetchInt(strhQuery, 0);
	}
	//Number of achievements of the player
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(`a`.`aid`) FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` = `b`.`amount` and `a`.`aid` = `b`.`id` ) ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievementdone = SQL_FetchInt(strhQuery, 0);
	}
	Format(strMessageTitle, sizeof(strMessageTitle), "%T", "Option delete achievements", LANG_SERVER, strNumberachievementdone,strNumberachievement);
	Format(strQuery, sizeof(strQuery), "SELECT `b`.`name` FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` = `b`.`amount` and `a`.`aid` = `b`.`id` )  ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	if (SQL_GetRowCount(strhQuery) == 0)
	{
		new Handle:strPanel =  CreatePanel();
		Format(strAch_Title, sizeof(strAch_Title), "%T", "No achievement done", LANG_SERVER);
		DrawPanelText(strPanel,strAch_Title);
		DrawPanelItem(strPanel, strExit);
		Format(strExit, sizeof(strExit), "%T", "Retour", LANG_SERVER);
		SetMenuTitle(strPanel, strMessageTitle);
		SendPanelToClient(strPanel, argClient, PanelHandlerNULL, 20);
	}
	else
	{
		new Handle:strPanel =  CreateMenu(PanelHandler3);
		while (SQL_FetchRow(strhQuery))
		{
			SQL_FetchString(strhQuery, 0, strAch_Title, sizeof(strAch_Title));
			AddMenuItem(strPanel,strAch_Title,strAch_Title);
		}
		SetMenuTitle(strPanel, strMessageTitle);
		DisplayMenu(strPanel,argClient,20);
	}
}

/*---------------------------------------------------------------------------------
				 C U S T O M   A C H I E V E M E N T S
			         P R I N C I P A L   M E N U   
---------------------------------------------------------------------------------*/
//MENU TO CHOOSE OPTION 
public Action:Panel_Menu(argClient, args)
{
	new String:strMessageTitle[255];
	new String:strMessageOption1[255];
	new String:strMessageOption2[255];
	new String:strMessageOption3[255];
	new String:strMessageOption4[255];
	new String:strYesorNot[20];
	new String:strExit[255];
	new String:strName[32];
	decl String:strQuery[255];
	new Handle:strhQuery;
	new strNumberachievement;
	new strNumberachievementdone;
	new String:strSteamidofclient[100];
	GetClientName(argClient, strName, sizeof(strName));
	GetClientAuthString(argClient, strSteamidofclient, sizeof(strSteamidofclient));
	//SQL
	//Number of achievements
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(*) FROM `%sconfig`",sTablePrefix);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievement = SQL_FetchInt(strhQuery, 0);
	}
	
	//Number of achievements of the player
	Format(strQuery, sizeof(strQuery), "SELECT COUNT(`a`.`aid`) FROM `%susers` a, `%sconfig` b WHERE `a`.`steamid` = '%s' and ( `a`.`interval` = `b`.`amount` and `a`.`aid` = `b`.`id` ) ;",sTablePrefix,sTablePrefix,strSteamidofclient);
	strhQuery = ConnectionBD(strQuery);
	while (SQL_FetchRow(strhQuery))
	{
		strNumberachievementdone = SQL_FetchInt(strhQuery, 0);
	}

	Format(strMessageTitle, sizeof(strMessageTitle), "%T", "Menu Panel Title", LANG_SERVER, strName,strNumberachievementdone,strNumberachievement);
	Format(strMessageOption1, sizeof(strMessageOption1), "%T", "Menu Panel show achievements done", LANG_SERVER);
	Format(strMessageOption2, sizeof(strMessageOption2), "%T", "Menu Panel show achievements not done", LANG_SERVER);
	if(StrEqual(g_ClientSteamID[argClient], "", false))
	{
		g_ClientSteamID[argClient] = strSteamidofclient;
		g_ClientConfigForPlugins[argClient] = 0;
	}
	else
	{
		if(!StrEqual(g_ClientSteamID[argClient], strSteamidofclient, false))
		{
			g_ClientSteamID[argClient] = strSteamidofclient;
			g_ClientConfigForPlugins[argClient] = 0;
		}
	}
	if(g_ClientConfigForPlugins[argClient] == 0)
	{
		Format(strYesorNot,sizeof(strYesorNot),"%T","Desactivate", LANG_SERVER);
	}
	else
	{
		Format(strYesorNot,sizeof(strYesorNot),"%T","Activate", LANG_SERVER);
	}
	Format(strMessageOption3, sizeof(strMessageOption3), "%T %s", "Show Progression of achievements", LANG_SERVER, strYesorNot);
	Format(strMessageOption4, sizeof(strMessageOption4), "%T", "Delete achievement", LANG_SERVER);
	Format(strExit, sizeof(strExit), "%T", "Exit", LANG_SERVER);
	g_panel_menu = CreatePanel();
	SetPanelTitle(g_panel_menu, strMessageTitle);
	DrawPanelItem(g_panel_menu, strMessageOption1);
	DrawPanelItem(g_panel_menu, strMessageOption2);
	DrawPanelItem(g_panel_menu, strMessageOption3);
	DrawPanelItem(g_panel_menu, strMessageOption4);
	DrawPanelItem(g_panel_menu, strExit);
	
	SendPanelToClient(g_panel_menu, argClient, PanelHandler1, 20);
	CloseHandle(g_panel_menu);
	return Plugin_Handled;
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
						   M E D I C  P O S S I B I L I T Y
---------------------------------------------------------------------------------*/
//Medic possibility
public Action:eCheckUber(Handle:argEvent, const String:argName[], bool:argNoBroadcast)
{
	new strUserid = GetEventInt(argEvent, "userid");
	new strClient = GetClientOfUserId(strUserid);
	
	SetPackPosition(g_bd_id_medic,0);
	SetPackPosition(g_bd_ida_medic,0);
	SetPackPosition(g_bd_ubercharge_weapons,0);
	new strIda_medic;
	decl String:KvWeaponsMedic[32];
	
	if (TF2_GetPlayerClass(strClient) != TFClass_Medic)
	{
		return Plugin_Handled;
	}
	
	for (new i = 0; i < g_maxAchievements_medic; i++)
	{
		strIda_medic = ReadPackCell(g_bd_ida_medic);
		ReadPackString(g_bd_ubercharge_weapons,KvWeaponsMedic,sizeof(KvWeaponsMedic));
		if(GetEntProp(GetPlayerWeaponSlot(strClient, 1), Prop_Send, "m_iItemDefinitionIndex") != 35)
		{
			if(StrEqual(KvWeaponsMedic,"Medigun",true))
			{
				ProcessAchievement(strIda_medic , strClient);
			}
		}
		else
		{
			if(StrEqual(KvWeaponsMedic,"Kritz",true))
			{
				ProcessAchievement(strIda_medic , strClient);
			}
		}
			
	}	
	return Plugin_Continue;
} 

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
						   S C O U T  P O S S I B I L I T Y
---------------------------------------------------------------------------------*/
//Scout Stunt
public Action:eCheckStun(Handle:argEvent, const String:argName[], bool:argNoBroadcast)
{
	new strStunnerUserId = GetEventInt(argEvent, "stunner");
	new strStunner = GetClientOfUserId(strStunnerUserId);
	new strVictimUserId = GetEventInt(argEvent, "victim");
	new strVictim= GetClientOfUserId(strVictimUserId);
	
	SetPackPosition(g_bd_id_scout,0);
	SetPackPosition(g_bd_ida_scout,0);
	SetPackPosition(g_bd_stunt_scout,0);
	SetPackPosition(g_bd_stuntvic_scout,0);
	SetPackPosition(g_bd_stuntattack_scout,0);
	
	new strIda_scout;
	new strStunt_scout;
	new strStuntvic_scout;
	new strStuntattack_scout;
	
	for (new i = 0; i < g_maxAchievements_scout; i++)
	{
		strIda_scout = ReadPackCell(g_bd_ida_scout);
		strStunt_scout = ReadPackCell(g_bd_stunt_scout);
		strStuntvic_scout = ReadPackCell(g_bd_stuntvic_scout);
		strStuntattack_scout = ReadPackCell(g_bd_stuntattack_scout);
		
		if(strStunt_scout == 1)
		{
			if (strStunner != 0)
			{
				if (strStuntvic_scout == 1)
					ProcessAchievement(strIda_scout, strVictim);
				if (strStuntattack_scout == 1)
					ProcessAchievement(strIda_scout, strStunner);
			}
		}
	}
	return Plugin_Continue;
}  

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
						      D E T E C T  S O U N D 
---------------------------------------------------------------------------------*/
public Action:HookSound_Callback(Clients[64], &NumClients, String:StrSample[PLATFORM_MAX_PATH], &Entity)
{
	//LogMessage("Sound = %s", StrSample);
    // Discard any other sound that the coughing
    if (StrContains(StrSample, "pl_scout_dodge_can_drink", false) == -1)   
	{
		if (StrContains(StrSample, "sandwicheat", false) == -1)    
			return Plugin_Continue;
		else
		{
			SetPackPosition(g_bd_ida_heavy,0); 
			SetPackPosition(g_bd_ida_heavy_own,0); 
			new strIda_heavy;
			new strHeavy_own;
			for (new i = 0; i < g_maxAchievements_heavy; i++)
			{
				strIda_heavy = ReadPackCell(g_bd_ida_heavy);
				strHeavy_own = ReadPackCell(g_bd_ida_heavy_own);
						
				if(strHeavy_own == 1)
				{
					if (Entity != 0)
					{
						ProcessAchievement(strIda_heavy, Entity);
					}
				}
			}
		}
	}	
	else
	{
		SetPackPosition(g_bd_ida_scout,0);
		SetPackPosition(g_bd_bonk_scout,0);
		new strIda_scout;
		new strBonk_scout;
		for (new i = 0; i < g_maxAchievements_scout; i++)
		{
			strIda_scout = ReadPackCell(g_bd_ida_scout);
			strBonk_scout = ReadPackCell(g_bd_bonk_scout);
			
			if(strBonk_scout == 1)
			{
				if (Entity != 0)
				{
					ProcessAchievement(strIda_scout, Entity);
				}
			}
		}
	}
	return Plugin_Continue;
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
						   S N I P E R  P O S S I B I L I T Y
---------------------------------------------------------------------------------*/
public Action:eJarated(UserMsg:msg_id, Handle:bf, const players[], playersNum, bool:reliable, bool:init)
{
	new strClient = BfReadByte(bf);
	new strVictim = BfReadByte(bf);
	
	SetPackPosition(g_bd_ida_sniper,0); 
	SetPackPosition(g_bd_ida_sniper_jarate,0); 
	SetPackPosition(g_bd_ida_sniper_jarate_vic,0); 
	SetPackPosition(g_bd_ida_sniper_jarate_attack,0); 
	 
	new strIda_sniper;
	new strSniper_jarate;
	new strSniper_jarate_vic;
	new strSniper_jarate_attack;
	
	for (new i = 0; i < g_maxAchievements_sniper; i++)
	{
		strIda_sniper = ReadPackCell(g_bd_ida_sniper);
		strSniper_jarate = ReadPackCell(g_bd_ida_sniper_jarate);
		strSniper_jarate_vic = ReadPackCell(g_bd_ida_sniper_jarate_vic);
		strSniper_jarate_attack = ReadPackCell(g_bd_ida_sniper_jarate_attack);
		
		if(strSniper_jarate == 1)
		{
			if(strSniper_jarate_attack == 1 && strClient !=0 )
				ProcessAchievement(strIda_sniper, strClient);
			else
				if(strSniper_jarate_vic == 1 && strVictim !=0)
					ProcessAchievement(strIda_sniper, strVictim);
		}
	}
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
						   S N I P E R  R A Z O R B A C K
---------------------------------------------------------------------------------*/
public Action:eShieldBlocked(UserMsg:msg_id, Handle:bf, const players[], playersNum, bool:reliable, bool:init)
{
	new strVictim = BfReadByte(bf);
	new strClient = BfReadByte(bf);
	
	SetPackPosition(g_bd_ida_sniper,0); 
	SetPackPosition(g_bd_ida_sniper_razor,0); 
	SetPackPosition(g_bd_ida_sniper_razor_vic,0); 
	SetPackPosition(g_bd_ida_sniper_razor_attack,0); 
		
	new strIda_sniper;
	new strSniper_razor;
	new strSniper_razor_vic;
	new strSniper_razor_attack;
	
	for (new i = 0; i < g_maxAchievements_sniper; i++)
	{
		strIda_sniper = ReadPackCell(g_bd_ida_sniper);
		strSniper_razor = ReadPackCell(g_bd_ida_sniper_razor);
		strSniper_razor_vic = ReadPackCell(g_bd_ida_sniper_razor_vic);
		strSniper_razor_attack = ReadPackCell(g_bd_ida_sniper_razor_attack);
		
		if(strSniper_razor == 1)
		{
			if(strSniper_razor_vic == 1 )
				ProcessAchievement(strIda_sniper, strVictim);
			else
				if(strSniper_razor_attack == 1 )
					ProcessAchievement(strIda_sniper, strClient);
		}
	}
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
					   E N G I N E E R  P O S S I B I L I T Y
					   C O N S T R U C  M E T H O D E 
---------------------------------------------------------------------------------*/
public Action:eCheckEngi(Handle:argEvent, const String:argName[], bool:argNoBroadcast)
{
	new strClientUserId = GetEventInt(argEvent, "userid");
	new strClient = GetClientOfUserId(strClientUserId);
	new strObject = GetEventInt(argEvent, "object");
	SetPackPosition(g_bd_ida_engineer,0); 
	SetPackPosition(g_bd_engineer_construction,0); 
	SetPackPosition(g_bd_engineer_sentry,0); 
	SetPackPosition(g_bd_engineer_dispenser,0);
	SetPackPosition(g_bd_engineer_teleporterentry,0);
	SetPackPosition(g_bd_engineer_teleporterexit,0);
	
	new strIda_engineer;
	new strEngineer_construction;
	new strEngineer_sentry;
	new strEngineer_dispenser;
	new strEngineer_teleporterentry;
	new strEngineer_teleporterexit;
	for (new i = 0; i < g_maxAchievements_engineer; i++)
	{
		strIda_engineer = ReadPackCell(g_bd_ida_engineer);
		strEngineer_construction = ReadPackCell(g_bd_engineer_construction);
		strEngineer_sentry = ReadPackCell(g_bd_engineer_sentry);
		strEngineer_dispenser = ReadPackCell(g_bd_engineer_dispenser);
		strEngineer_teleporterentry = ReadPackCell(g_bd_engineer_teleporterentry);
		strEngineer_teleporterexit = ReadPackCell(g_bd_engineer_teleporterexit);
		
		if(strEngineer_construction == 1)
		{
			if(strEngineer_sentry == 1 && strClient !=0 && strObject == 3)
				ProcessAchievement(strIda_engineer,strClient);
			else
				if(strEngineer_dispenser == 1 && strClient !=0 && strObject == 0)
					ProcessAchievement(strIda_engineer,strClient);
				else
					if(strEngineer_teleporterentry == 1 && strClient !=0 && strObject == 1)
						ProcessAchievement(strIda_engineer,strClient);
					else
						if(strEngineer_teleporterexit == 1 && strClient !=0 && strObject == 2)
							ProcessAchievement(strIda_engineer,strClient);
		}
	}
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
					   E N G I N E E R  P O S S I B I L I T Y
					     D E S T R U C        M E T H O D E 
---------------------------------------------------------------------------------*/
public Action:eCheckEngi2(Handle:argEvent, const String:argName[], bool:argNoBroadcast)
{
	new strAttackantUserId = GetEventInt(argEvent, "attacker");
	new strAttackant = GetClientOfUserId(strAttackantUserId);
	new strObject = GetEventInt(argEvent, "objecttype");
	new strClientUserId = GetEventInt(argEvent, "userid");
	new strClient = GetClientOfUserId(strClientUserId);
	new strWas_build = GetEventInt(argEvent, "was_building");
	
	SetPackPosition(g_bd_ida_engineer,0); 
	SetPackPosition(g_bd_engineer_destruction,0); 
	SetPackPosition(g_bd_engineer_sentry,0); 
	SetPackPosition(g_bd_engineer_dispenser,0);
	SetPackPosition(g_bd_engineer_teleporterentry,0);
	SetPackPosition(g_bd_engineer_teleporterexit,0);
	SetPackPosition(g_bd_engineer_des_vic,0);
	SetPackPosition(g_bd_engineer_des_attack,0);
	SetPackPosition(g_bd_engineer_des_was_build,0);
	
	new strIda_engineer;
	new strEngineer_destruction;
	new strEngineer_sentry;
	new strEngineer_dispenser;
	new strEngineer_teleporterentry;
	new strEngineer_teleporterexit;
	new strEngineer_des_vic;
	new strEngineer_des_attack;
	new strEngineer_des_build;
	
	for (new i = 0; i < g_maxAchievements_engineer; i++)
	{
		strIda_engineer = ReadPackCell(g_bd_ida_engineer);
		strEngineer_destruction = ReadPackCell(g_bd_engineer_destruction);
		strEngineer_sentry = ReadPackCell(g_bd_engineer_sentry);
		strEngineer_dispenser = ReadPackCell(g_bd_engineer_dispenser);
		strEngineer_teleporterentry = ReadPackCell(g_bd_engineer_teleporterentry);
		strEngineer_teleporterexit = ReadPackCell(g_bd_engineer_teleporterexit);
		strEngineer_des_vic = ReadPackCell(g_bd_engineer_des_vic);
		strEngineer_des_attack = ReadPackCell(g_bd_engineer_des_attack);
		strEngineer_des_build = ReadPackCell(g_bd_engineer_des_was_build);
		
		if(strEngineer_destruction == 1)
		{
			//LogMessage("Victim : strEngineer_sentry == %i & strClient == %i & strObject == %i & strEngineer_des_vic == %i & strWas_build== %i & strEngineer_des_build == %i", strEngineer_sentry,strClient,strObject,strEngineer_des_vic,strWas_build,strEngineer_des_build);
			//LogMessage("Attack : strEngineer_sentry == %i & strAttackant == %i & strObject == %i & strEngineer_des_attack == %i & strWas_build== %i & strEngineer_des_build == %i", strEngineer_sentry,strAttackant,strObject,strEngineer_des_attack,strWas_build,strEngineer_des_build);
			if(strEngineer_sentry == 1 && strClient !=0 && strObject == 3 && strEngineer_des_vic == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strClient);
			if(strEngineer_sentry == 1 && strAttackant !=0 && strObject == 3 && strEngineer_des_attack == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strAttackant);
			if(strEngineer_dispenser == 1 && strClient !=0 && strObject == 0 && strEngineer_des_vic == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strClient);
			if(strEngineer_dispenser == 1 && strAttackant !=0 && strObject == 0 && strEngineer_des_attack == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strAttackant);
			if(strEngineer_teleporterentry == 1 && strClient !=0 && strObject == 1 && strEngineer_des_vic == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strClient);
			if(strEngineer_teleporterentry == 1 && strAttackant !=0 && strObject == 1 && strEngineer_des_attack == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strAttackant);
			if(strEngineer_teleporterexit == 1 && strClient !=0 && strObject == 2 && strEngineer_des_vic == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer,strClient);
			if(strEngineer_teleporterexit == 1 && strAttackant !=0 &&  strObject == 2 && strEngineer_des_attack == 1 && strWas_build==strEngineer_des_build)
				ProcessAchievement(strIda_engineer, strAttackant);
		}
	}
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
					   E N G I N E E R  P O S S I B I L I T Y
					       T E L E P O R T  A C T I O N S 
---------------------------------------------------------------------------------*/
public Action:eCheckEngi3(Handle:argEvent, const String:argName[], bool:dontBroadcast)
{
	new strBuilderUserId = GetEventInt(argEvent, "builderid");
	new strBuilder = GetClientOfUserId(strBuilderUserId);
	new strUseridUserId = GetEventInt(argEvent, "userid");
	new strUserid = GetClientOfUserId(strUseridUserId);
	SetPackPosition(g_bd_ida_engineer,0); 
	SetPackPosition(g_bd_engineer_teleport,0); 
	SetPackPosition(g_bd_engineer_teleport_build,0); 
	SetPackPosition(g_bd_engineer_teleport_play,0);
	
	new strIda_engineer;
	new strEngineer_teleport;
	new strEngineer_teleport_build;
	new strEngineer_teleport_play;
	
	for (new i = 0; i < g_maxAchievements_engineer; i++)
	{
		strIda_engineer = ReadPackCell(g_bd_ida_engineer);
		strEngineer_teleport = ReadPackCell(g_bd_engineer_teleport);
		strEngineer_teleport_build = ReadPackCell(g_bd_engineer_teleport_build);
		strEngineer_teleport_play = ReadPackCell(g_bd_engineer_teleport_play);
			
		if(strEngineer_teleport == 1)
		{
			if(strEngineer_teleport_build == 1 && strBuilder !=0 && (strBuilder != strUserid))
				ProcessAchievement(strIda_engineer, strBuilder);
			else
				if(strEngineer_teleport_play == 1 && strUserid !=0 && (strBuilder != strUserid))
					ProcessAchievement(strIda_engineer, strUserid);
		}
	}
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
					      H E A V Y  P O S S I B I L I T Y
					      S T E A L  S A N D W I T C H ( S )
---------------------------------------------------------------------------------*/
public eStealSandvich(Handle:argEvent, const String:argName[], bool:dontBroadcast)
{
	new strTargetUserid = GetEventInt(argEvent, "target");
	new strOwnerUserid = GetEventInt(argEvent, "owner");
	new strTarget = GetClientOfUserId(strTargetUserid);
	new strOwner = GetClientOfUserId(strOwnerUserid);
	SetPackPosition(g_bd_ida_heavy,0); 
	SetPackPosition(g_bd_ida_heavy_own,0); 
	SetPackPosition(g_bd_ida_heavy_notown,0); 
	SetPackPosition(g_bd_ida_heavy_notown_target,0); 
	SetPackPosition(g_bd_ida_heavy_notown_own,0); 
	
	new strIda_heavy;
	new strHeavy_own;
	new strHeavy_notown;
	new strHeavy_notown_target;
	new strHeavy_notown_own;
	for (new i = 0; i < g_maxAchievements_heavy; i++)
	{
		strIda_heavy = ReadPackCell(g_bd_ida_heavy);
		strHeavy_own = ReadPackCell(g_bd_ida_heavy_own);
		strHeavy_notown_target = ReadPackCell(g_bd_ida_heavy_notown_target);
		strHeavy_notown = ReadPackCell(g_bd_ida_heavy_notown);
		if(strHeavy_own == 1)
		{
			if(strOwner == strTarget)
				ProcessAchievement(strIda_heavy, strTarget);
		}
		if(strHeavy_notown == 1)
		{
			if(strHeavy_notown_target == 1)
				ProcessAchievement(strIda_heavy, strTarget);
			if(strHeavy_notown_own == 1)
				ProcessAchievement(strIda_heavy, strOwner);
		}
	}
}

/*---------------------------------------------------------------------------------
                                      V 0 . 6 
					         F U N  P O S S I B I L I T Y
					             C A L L  M E D I C
---------------------------------------------------------------------------------*/
public eMedicCall(Handle:argEvent, const String:argName[], bool:dontBroadcast)
{
	new strIda_fun;
	new strCallMedic;
	new strUserid = GetEventInt(argEvent, "userid");
	new strClient = GetClientOfUserId(strUserid);
	
	SetPackPosition(g_bd_ida_fun,0);
	SetPackPosition(g_bd_callmedic_fun,0);
	for (new i = 0; i < g_maxAchievements_fun; i++)
	{
		strIda_fun = ReadPackCell(g_bd_ida_fun);
		strCallMedic = ReadPackCell(g_bd_callmedic_fun);
		if(strCallMedic == 1)
		{
			ProcessAchievement(strIda_fun, strClient);
		}
	}
}

